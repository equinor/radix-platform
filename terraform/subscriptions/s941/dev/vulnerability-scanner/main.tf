resource "azurerm_resource_group" "rg" {
  name     = "vulnerability-scan"
  location = "North Europe"
}

module "sqldatabase" {
  source = "../../../modules/mssqldatabase"
  env    = "dev"

  database_name          = "vulnerability-scan"
  server_name            = "sql-radix-vulnerability-scan-dev"
  admin_adgroup = "Radix Platform Developers"
  administrator_login    = "radix"
  administrator_password = "hello-world" #TODO: Fix
  rg_name                = azurerm_resource_group.rg.name
  location               = azurerm_resource_group.rg.location
  zone_redundant         = false
}


# IAM

resource "azurerm_user_assigned_identity" "admin" {
  name                = "mi-radix-vulnerability-scanner-writer"
  location            = azurerm_resource_group.rg.location
  resource_group_name = azurerm_resource_group.rg.name
}

data "azuread_group" "admin" {
  display_name     = module.sqldatabase.admin_adgroup
  security_enabled = true
}
resource "azuread_group_member" "mygrpmember" {
  group_object_id  = data.azuread_group.admin.id
  member_object_id = azurerm_user_assigned_identity.admin.principal_id
}

resource "azurerm_federated_identity_credential" "github" {
  audience            = []
  issuer              = ""
  name                = ""
  parent_id           = ""
  resource_group_name = ""
  subject             = ""
}
